# 1. cutscene函数
通过冻结玩家输入并播放特定坐标的 Sprite 动画来实现，不要做复杂的过场系统。

# 2. 如何让策划顺利配置与编辑地图？

在 TIC-80 中，策划最怕的是改代码。你可以通过 **“Tile 属性约定”** 来解耦。

1.  **Map Editor 约定**：
    *   约定某些 **Tile ID** 代表特定功能。
    *   例如：ID 1-16 是墙，ID 17 是门，ID 18 是陷阱，ID 19 是出生点。
    *   策划直接在 TIC-80 的地图编辑器里画图，你程序读取 `mget(x, y)` 即可判断。
2.  **对象层（Object Layer）模拟**：
    *   TIC-80 没有对象层，你可以约定：**在 Map 的第 1 帧画背景，第 2 帧画可交互物体（如宝箱、老鼠）**。
    *   程序初始化时扫描全图：
        ```lua
        for y=0,16 do
          for x=0,29 do
            local id = mget(x,y)
            if id == SPAWN_RAT then spawn_entity("rat", x*8, y*8) end
          end
        end
        ```
3.  **配置表 (Simple Config)**：
    *   在代码顶部留出一个配置区，让策划改数值：
        ```lua
        -- CONFIG AREA (FOR DESIGNER)
        HP_MAX = 100
        TRAP_DAMAGE = 20
        STUN_TIME = 60 -- 1秒(60帧)
        SPEED_NORMAL = 1.2
        SPEED_FAST = 2.0
        ```

# 3. 素材清单

可能有 2x2, 3x3 的 Sprite，建议建立一个 **Sprite Sheet 索引表**。

#### 1. 角色/生物类 (Sprites)
*   **金发保安 (2x2)**：上下左右走动（建议每方向2帧），攻击动作，受击闪烁。
*   **红发保安 (2x2)**：同上（第六关用）。
*   **贼 (2x2)**：蒙面状态，露脸状态（金发），攻击/冲刺状态。
*   **老鼠 (1x1)**：左右爬行，一滩血（死亡）。
*   **鬼魂 (1x1 或 2x2)**：漂浮动画。

#### 2. 环境/物件类 (Tiles/Sprites)
*   **展柜 (2x2)**：完好状态（带闪光）、破碎状态、带藏品、空状态。
*   **容器 (1x1 或 2x2)**：木箱、柜子（关闭/打开）。
*   **道具**：钥匙、创口贴、绷带、止痛药（建议带发光特效，方便玩家识别）。
*   **陷阱**：夹子（打开/闭合）、水渍。
*   **门**：横向/纵向，开启/关闭。

#### 3. UI/演出类
*   **半透明黑边**：用于模拟监控摄像头的暗角。
*   **对话框背景**：9-slice 格式或简单的纯黑底。
*   **结局原画**：如果时间够，画两张全屏的简单像素画（成功/失败）。

# 4. 开发架构

建议将代码拆分为以下模块，方便程序写逻辑，策划改参数：

```lua
-- [1. Global Constants & Config] -> 策划改这里
-- [2. Input & Movement] -> 处理长按3秒加速逻辑
-- [3. Entity System] -> 处理血量、受击、无敌时间
-- [4. AI logic] -> 贼的状态机
-- [5. Interaction] -> 处理 M 键触发的逻辑 (钥匙、门、药)
-- [6. Map & Render] -> 处理不同关卡的初始化
```

**关于“长按3秒加速”逻辑的提醒：**
在 TIC-80 这种快节奏环境下，3秒是非常长的。建议改成 **1秒**，或者增加一个明显的“蓄力动画/进度条”，否则玩家会觉得移动很迟钝。

**关于 2x2/3x3 Sprites 的绘制函数：**
```lua
function draw_big_sprite(id, x, y, w, h, flip)
    -- w, h 为占多少个 8x8 格子
    spr(id, x, y, 0, 1, flip, 0, w, h)
end
```

# 5. 射线检测

既然有“视野检测”，用 `line(x1, y1, x2, y2)` 是不可视的，你需要用 `pix` 或 `mget` 在贼的前方做步进探测：
```lua
function check_vision(ex, ey, p_x, p_y)
    -- 简单的坐标范围检测，或者在x,y方向发射虚拟点检测墙壁
    -- 48h 建议直接用简单的：如果距离 < 64 像素且没有墙 = 发现玩家
end
```

# 6. 碰撞检测

角色地图的碰撞，角色各种交互的碰撞，比如hitbox, 还有和物品的交互，场景的交互等，需要统一管理。
地图碰撞: is_wall, can_move
sprite碰撞: AABB

DONE!

# 7. subtitle system

DONE！

# 8. interaction & attack

# 8.0 老鼠激光移动

DONE！

# 8.1 先把攻击老鼠做出来

hitbox & hurtbox

DONE

# 8.2 debug显示

显示所有碰撞盒，DONE。

# 8.3 移动系统

加了vel，加速度层，DONE！

# 8.31 陷阱实现

DONE!

# 8.32 容器实现

# 8.32 攻击动画优化

可以加入旋转？放弃，tic80不支持。



# 8.4 贼的实现




# 9. 定时器系统

DONE!!!

# 10. 动画

把人物的移动动画制作出来
DONE!